
<!--sidebar-->

<script type="text/javascript">
		angular.module('stockWatchApp', []).controller('stockWatchController', function($scope, $http) {
		  	
			$scope.init = function() {
				//$scope.lookupTicker();
			}

			$scope.typingTimer;
			$scope.doneTypingInterval = 700;

			$scope.submit = function() {
				$scope.lookupSymbol()
					.done(function(companies) {
						var symbol = companies[0].Symbol;
						$scope.getQuote(symbol);
						$scope.getSentiment(symbol);
					});
			}


			$scope.autocomplete = function() {
				//console.log("Length: " + $scope.searchTerm.length);
				if ($scope.searchTerm.length >= 3) {
					clearTimeout($scope.typingTimer);
				   	$scope.typingTimer = setTimeout(
				        function(){ 
				        	console.log("Performing Lookup");
							$scope.lookupSymbol()
								.done(function(companies) {
									$scope.$apply();
								});
				        },
				        $scope.doneTypingInterval
				    );
					
				}
				else
				{
					$scope.companies = [];
				}
			}


			$scope.lookupSymbol = function() {
				var apiUrl = "http://dev.markitondemand.com/Api/v2/Lookup/jsonp?input=" + $scope.searchTerm;

				return $.ajax({
					        url: apiUrl,
					        dataType: "jsonp"
						}).done(function(response) {
						  	console.log("Companies: %O", response);
						  	$scope.companies = response;
						  	return $scope.companies;
						});
			}

			$scope.getQuote = function(symbol) {
				var apiUrl = "http://dev.markitondemand.com/Api/v2/Quote/jsonp?symbol=" + symbol;

				return $.ajax({
					        url: apiUrl,
					        dataType: "jsonp"
						}).done(function(response) {
						  	console.log("Quote: %O", response);
						  	$scope.quote = response;
						  	return $scope.quote;
						});
			}

			$scope.getSentiment = function(symbol) {
				var apiKey = "3c41002ea759f8dbbb0d81e714cac64f";
				var d = new Date(new Date().setDate(new Date().getDate()-2));
				var from = d.getFullYear().toString() + ("0" + (d.getMonth() + 1)).slice(-2).toString() + ("0" + d.getDate()).slice(-2).toString();
				var to = from;
				console.log("Symbol: " + symbol);
				console.log("From: " + from);

				
				return $.ajax({
							data: { api_key: apiKey, symbol: symbol, from: from, to: from },
					        url: apiUrl,
					        dataType: "jsonp"
						}).done(function(response) {
						  	console.log("Sentiment: %O", response);
						  	$scope.sentiment = response;
						  	return $scope.sentiment;
						});

				
			}

			
			$scope.init();
		});
  </script>
  

<div ng-app="stockWatchApp" >
	<div ng-controller="stockWatchController">
		<!-- <label for="quote">Get Quote!</label> -->
		<input id="quote" type="text" ng-model="searchTerm" ng-change="autocomplete()"></input>
		<div class="btn btn-default" ng-click="submit()">Get Quote!</div>
		<ul>
			<li ng-repeat="company in companies">
				{{company.Name}} ({{company.Symbol}})
			</li>
		</ul>
		<div>{{}}</div>
	</div>
</div>


<div class="navbar-default sidebar" role="navigation">
	<ul class="nav" id ="side-menu">
		<li class="sidebar-search">
			<div class="input-group custom-search-form">
				<input type="text" class="form-control" placeholder= "Company/Symbol" id="search_bar"/>
					<div class="input-group-btn">
						<button type="submit" class= "btn btn-default search" id="quote_button">
							<i class="glyphicon glyphicon-search"></i>
						</button>	
					</div>
			</div>
		</li>
	
		<li>
			<div class="panel panel-default">
				<div class="panel-heading">
					<div class='panel-title'>Twitter Feed</div>
				</div>
			</div>
		</li>
	</ul>
</div>
</div>
<div id="page-wrapper">
<div class="row">
	<div class="col-lg-12">
		<h3 class="page-header">This is where the quote info is</h3>
	</div>
</div>	
	<div class="row" />
	
	<div class="col-lg-8">
		<div class="panel panel-default">
			<div class="panel-heading">
				<i class="glyphicon glyphicon-signal"></i>&nbspChart Area
			</div>
			<div class="panel-body">
				<div>Graph</div>
			</div>
		</div>	
	</div>
	<div class="col-lg-4">
		<div class="panel panel-default">
			<div class="panel-heading">
				<i class="glyphicon glyphicon-list-alt"></i>&nbspCompany News
			</div>
			<div class="panel-body">
				<div></div>
			</div>
		</div>	
	</div>

</div>	
</div>

